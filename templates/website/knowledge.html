{% extends 'website/base.html' %}
{% load static %}

{% block title %}Knowledge Center - Equacare LLC{% endblock %}

{% block content %}
<!-- Knowledge Center -->
<section class="knowledge-center-simple">
    <div class="container">
        <!-- Header -->
        <div class="knowledge-simple-header">
            <h1>Knowledge Center</h1>
            <p>Important notices and helpful resources</p>
        </div>

        <!-- Notices Section - Compact Grid -->
        <div class="knowledge-section">
            <h2><i class="fas fa-bullhorn"></i> Notices & Announcements</h2>
            
            {% if notices %}
                <div class="notices-grid-compact">
                    {% for notice in notices %}
                    <div class="notice-card-compact">
                        <div class="notice-compact-header">
                            <span class="notice-icon"><i class="fas fa-bell"></i></span>
                            <span class="notice-date-compact">{{ notice.created_at|date:"M d, Y" }}</span>
                        </div>
                        <h3>{{ notice.title }}</h3>
                        <p class="notice-preview">{{ notice.content|truncatewords:30 }}</p>
                        <button class="read-more-btn" onclick="openNoticeModal({{ forloop.counter0 }})">
                            Read More <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No notices at this time. Check back later for updates.</p>
                </div>
            {% endif %}
        </div>

        <!-- Documents Section - Ultra Compact List -->
        <div class="knowledge-section documents-section">
            <h2><i class="fas fa-file-pdf"></i> Documents & Resources</h2>
            <p class="section-subtitle">Download helpful forms, guides, and information</p>
            
            {% if documents %}
                <div class="documents-list-compact">
                    {% for document in documents %}
                    <div class="document-item-compact">
                        <div class="document-info">
                            <i class="fas {{ document.get_file_icon }} doc-icon {{ document.get_file_color }}"></i>
                            <div class="document-text">
                                <h3>{{ document.title }}</h3>
                                <span class="doc-category">{{ document.get_category_display }} â€¢ {{ document.get_file_extension|upper }}</span>
                            </div>
                        </div>
                        {% if document.access_type == 'view' %}
                        <a href="{{ document.file.url }}" class="doc-view-compact" target="_blank">
                            <i class="fas fa-eye"></i>
                            <span>View</span>
                        </a>
                        {% else %}
                        <a href="{{ document.file.url }}" class="doc-download-compact" download target="_blank">
                            <i class="fas fa-download"></i>
                            <span>Download</span>
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <p>No documents available at this time. Check back later for resources.</p>
                </div>
            {% endif %}
        </div>

        <!-- Contact CTA -->
        <div class="knowledge-simple-cta">
            <h2>Have Questions?</h2>
            <p>Contact us for more information</p>
            <div class="knowledge-simple-buttons">
                {% if site_settings %}
                <a href="tel:{{ site_settings.phone_link }}" class="btn btn-primary btn-lg"><i class="fas fa-phone"></i> Call {{ site_settings.phone }}</a>
                {% else %}
                <a href="tel:+15155081556" class="btn btn-primary btn-lg"><i class="fas fa-phone"></i> Call (515) 508-1556</a>
                {% endif %}
                <a href="{% url 'website:contact' %}" class="btn btn-secondary btn-lg">Contact Us</a>
            </div>
        </div>
    </div>
</section>

<!-- Notice Modals -->
{% if notices %}
{% for notice in notices %}
<div id="noticeModal{{ forloop.counter0 }}" class="notice-modal">
    <div class="notice-modal-content">
        <div class="notice-modal-header">
            <div>
                <h2>{{ notice.title }}</h2>
                <p class="notice-modal-date"><i class="fas fa-calendar-alt"></i> {{ notice.created_at|date:"F d, Y" }}</p>
            </div>
            <button class="notice-modal-close" onclick="closeNoticeModal({{ forloop.counter0 }})">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notice-modal-body">
            <p>{{ notice.content|linebreaks }}</p>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<script>
// Notice Modal Functions
function openNoticeModal(index) {
    const modal = document.getElementById('noticeModal' + index);
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeNoticeModal(index) {
    const modal = document.getElementById('noticeModal' + index);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Close on outside click or Escape key
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('notice-modal')) {
        e.target.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
});

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        document.querySelectorAll('.notice-modal').forEach(m => m.style.display = 'none');
        document.body.style.overflow = 'auto';
    }
});
</script>

{% endblock %}
